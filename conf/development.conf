include shared.conf;

worker_processes  4;
error_log /dev/stderr notice;

events {
	worker_connections 1024;
}

http {
	access_log /dev/stdout;
	lua_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;
	lua_ssl_verify_depth 2;
	lua_package_path ";;$prefix/lua/?.lua;";
	lua_code_cache off; #only during development
	resolver 127.0.0.11 ipv6=off; # use docker local resolver and disable IPv6
	init_by_lua_file lua/init.lua;
	init_worker_by_lua_file lua/init_worker.lua;
	lua_shared_dict bot 1m;
	server {
		listen 80;
		charset utf-8;
		charset_types application/json;
		default_type application/json;
		location / {
			content_by_lua_file lua/handler.lua;
		}
	}
}
